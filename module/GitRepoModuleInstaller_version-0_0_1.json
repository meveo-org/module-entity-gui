[
  {
    "active": true,
    "code": "GitRepoModuleInstaller",
    "description": "Module that installs a module in a Git Repo",
    "license": "GPL",
    "currentVersion": "0.0.1",
    "transient": true,
    "codeOnly": false,
    "inDraft": true,
    "moduleItems": [
      {
        "dtoClassName": "org.meveo.api.dto.notification.ScriptNotificationDto",
        "dtoData": {
          "active": true,
          "code": "InstallModuleFromGitRepo",
          "classNameFilter": "org.meveo.model.git.GitRepository",
          "eventTypeFilter": "CREATED",
          "scriptInstanceCode": "org.meveo.script.InstallModuleFromGitRepoScript",
          "scriptParams": {
            "repo": "#{event}"
          },
          "priority": 1
        }
      },
      {
        "dtoClassName": "org.meveo.api.dto.ScriptInstanceDto",
        "dtoData": {
          "active": true,
          "code": "org.meveo.script.InstallModuleFromGitRepoScript",
          "description": "InstallModuleFromGitRepoScript",
          "inputs": [],
          "outputs": [],
          "generateOutputs": false,
          "type": "JAVA",
          "script": "package org.meveo.script;\n\nimport java.io.File;\nimport java.io.IOException;\nimport java.io.FileInputStream;\nimport java.io.InputStream;\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.Map;\n\nimport org.apache.commons.collections.CollectionUtils;\nimport org.meveo.service.script.Script;\nimport org.meveo.admin.exception.BusinessException;\nimport org.meveo.commons.utils.ParamBean;\nimport org.meveo.commons.utils.ParamBeanFactory;\nimport org.meveo.commons.utils.FileUtils;\nimport org.meveo.model.git.GitRepository;\nimport org.meveo.api.dto.module.MeveoModuleDto;\nimport org.meveo.api.exception.MeveoApiException;\nimport org.meveo.api.module.MeveoModuleApi;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\npublic class InstallModuleFromGitRepoScript extends Script {\n\n    private static final Logger LOG = LoggerFactory.getLogger(InstallModuleFromGitRepoScript.class);\n    private MeveoModuleApi moduleApi;\n    private static ParamBeanFactory paramBeanFactory;\n    private ParamBean config;\n    private String repositoryPath;\n\n    public InstallModuleFromGitRepoScript() {\n        moduleApi = (MeveoModuleApi) getServiceInterface(\"MeveoModuleApi\");\n        paramBeanFactory = (ParamBeanFactory) getServiceInterface(\"ParamBeanFactory\");\n        config = paramBeanFactory.getInstance();\n        String rootDirectory = config.getProperty(\"provider.rootDir\", \"default\");\n        String basePath = config.getProperty(\"providers.rootDir\", File.separator + \"meveodata\");\n        basePath += File.separator + rootDirectory + File.separator;\n        repositoryPath = basePath + \"git\" + File.separator;\n    }\n\n    @Override\n    public void execute(Map<String, Object> parameters) throws BusinessException {\n        super.execute(parameters);\n        LOG.debug(\"InstallModuleFromGitRepoScript ==> START\");\n        GitRepository repo = (GitRepository) parameters.get(\"repo\");\n        String code = repo.getCode();\n        String basePath = config.getProperty(\"providers.rootDir\", File.separator + \"meveodata\");\n        String rootDirectory = config.getProperty(\"provider.rootDir\", \"default\");\n        basePath += File.separator + rootDirectory + File.separator;\n        String gitPath = basePath + \"git\" + File.separator + code;\n        String moduleDirectoryPath = gitPath + File.separator + \"module\";\n        try {\n            File moduleFile = FileUtils.getFirstFile(moduleDirectoryPath, Arrays.asList(\"json\"));\n\n            LOG.debug(\"code : {}\", code);\n            LOG.debug(\"moduleDirectoryPath : {}\", moduleDirectoryPath);\n            LOG.debug(\"moduleFile.getPath() : {}\", moduleFile.getPath());\n\n            InputStream moduleFileStream = new FileInputStream(moduleFile);\n            List<MeveoModuleDto> modules = moduleApi.getModules(moduleFileStream);\n            moduleApi.importJSON(modules, true);\n        } catch (IOException ioe) {\n            throw new BusinessException(ioe);\n        } catch (MeveoApiException mae) {\n            throw new BusinessException(mae);\n        }\n\n        LOG.debug(\"InstallModuleFromGitRepoScript ==> END\");\n    }\n}\n",
          "executionRoles": [],
          "sourcingRoles": [],
          "mavenDependencies": [],
          "importScriptInstances": []
        }
      },
      {
        "dtoClassName": "org.meveo.api.dto.notification.ScriptNotificationDto",
        "dtoData": {
          "active": true,
          "code": "GenerateCustomEntityGUI",
          "classNameFilter": "org.meveo.model.customEntities.CustomEntityInstance",
          "eventTypeFilter": "CREATED",
          "elFilter": "#{event.getCetCode() == 'ENTITY_GUI_CONFIG'}",
          "scriptInstanceCode": "org.meveo.script.GenerateCustomEntityGUIScript",
          "scriptParams": {},
          "priority": 1
        }
      },
      {
        "dtoClassName": "org.meveo.api.dto.CustomEntityTemplateDto",
        "dtoData": {
          "code": "ENTITY_GUI_CONFIG",
          "name": "Entity UI Application Configuration",
          "description": "Create GUI for a Custom Entity",
          "customEntityCategoryCode": "ENTITY_UI",
          "availableStorages": ["SQL"],
          "sqlStorageConfiguration": {
            "storeAsTable": false
          },
          "samples": [],
          "fields": [
            {
              "code": "label",
              "description": "The label for menus and notifications of an entity",
              "fieldType": "STRING",
              "accountLevel": "CE_ENTITY_GUI_CONFIG",
              "appliesTo": "CE_ENTITY_GUI_CONFIG",
              "useInheritedAsDefaultValue": false,
              "storageType": "SINGLE",
              "valueRequired": true,
              "versionable": false,
              "triggerEndPeriodEvent": false,
              "listValues": {},
              "allowEdit": true,
              "hideOnNew": false,
              "maxValue": 255,
              "contentTypes": [],
              "fileExtensions": [],
              "saveOnExplorer": false,
              "guiPosition": "tab:Entity UI Application Configuration:0;field:1",
              "identifier": false,
              "storages": ["SQL"],
              "samples": [],
              "summary": false,
              "filter": false,
              "unique": false,
              "matrixColumns": []
            },
            {
              "code": "name",
              "description": "The Entity's name",
              "fieldType": "STRING",
              "accountLevel": "CE_ENTITY_GUI_CONFIG",
              "appliesTo": "CE_ENTITY_GUI_CONFIG",
              "useInheritedAsDefaultValue": false,
              "storageType": "SINGLE",
              "valueRequired": true,
              "versionable": false,
              "triggerEndPeriodEvent": false,
              "listValues": {},
              "allowEdit": true,
              "hideOnNew": false,
              "maxValue": 255,
              "contentTypes": [],
              "fileExtensions": [],
              "saveOnExplorer": false,
              "guiPosition": "tab:Entity UI Application Configuration:0;field:0",
              "identifier": false,
              "storages": ["SQL"],
              "samples": [],
              "summary": false,
              "filter": false,
              "unique": false,
              "matrixColumns": []
            }
          ],
          "actions": []
        }
      },
      {
        "dtoClassName": "org.meveo.api.dto.ScriptInstanceDto",
        "dtoData": {
          "active": true,
          "code": "org.meveo.script.GenerateCustomEntityGUIScript",
          "description": "GenerateCustomEntityGUIScript",
          "inputs": [],
          "outputs": [],
          "generateOutputs": false,
          "type": "JAVA",
          "script": "package org.meveo.script;\r\n\r\nimport java.util.Map;\r\nimport org.meveo.service.script.Script;\r\nimport org.meveo.admin.exception.BusinessException;\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\n\r\npublic class GenerateCustomEntityGUIScript extends Script {\r\n\r\n    private static final Logger LOG = LoggerFactory.getLogger(GenerateCustomEntityGUIScript.class);\r\n\r\n    @Override\r\n    public void execute(Map<String, Object> parameters) throws BusinessException {\r\n        super.execute(parameters);\r\n        LOG.debug(\"GenerateCustomEntityGUIScript ==> START\");\r\n        LOG.debug(\"parameters: {}\", parameters);\r\n        for (Map.Entry<String, Object> entry : parameters.entrySet()) {\r\n            LOG.debug(\"{}: {}\", entry.getKey(), entry.getValue());\r\n        }\r\n        LOG.debug(\"GenerateCustomEntityGUIScript ==> END\");\r\n    }\r\n}\r\n",
          "executionRoles": [],
          "sourcingRoles": [],
          "mavenDependencies": [],
          "importScriptInstances": []
        }
      },
      {
        "dtoClassName": "org.meveo.api.dto.CustomEntityTemplateDto",
        "dtoData": {
          "code": "TEMPLATE_PATH",
          "name": "Template Path",
          "description": "Entity GUI template path",
          "customEntityCategoryCode": "ENTITY_UI",
          "availableStorages": ["SQL"],
          "sqlStorageConfiguration": {
            "storeAsTable": false
          },
          "samples": [],
          "fields": [
            {
              "code": "path",
              "description": "The path where templates for Entity GUI generation are found.",
              "fieldType": "STRING",
              "accountLevel": "CE_TEMPLATE_PATH",
              "appliesTo": "CE_TEMPLATE_PATH",
              "useInheritedAsDefaultValue": false,
              "storageType": "SINGLE",
              "valueRequired": true,
              "versionable": false,
              "triggerEndPeriodEvent": false,
              "listValues": {},
              "allowEdit": true,
              "hideOnNew": false,
              "maxValue": 255,
              "contentTypes": [],
              "fileExtensions": [],
              "saveOnExplorer": false,
              "guiPosition": "tab:Template Path:0;field:1",
              "identifier": false,
              "storages": ["SQL"],
              "samples": [],
              "summary": false,
              "filter": false,
              "unique": false,
              "matrixColumns": []
            }
          ],
          "actions": []
        }
      },
      {
        "dtoClassName": "org.meveo.api.dto.CustomEntityCategoryDto",
        "dtoData": {
          "code": "ENTITY_UI",
          "name": "Entity GUI"
        }
      }
    ],
    "moduleDependencies": [],
    "moduleFiles": []
  }
]
