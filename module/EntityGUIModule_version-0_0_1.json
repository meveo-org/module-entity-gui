[ {
  "active" : true,
  "code" : "EntityGUIModule",
  "description" : "Entity GUI Module",
  "license" : "GPL",
  "currentVersion" : "0.0.1",
  "transient" : true,
  "codeOnly" : false,
  "inDraft" : true,
  "moduleItems" : [ {
    "dtoClassName" : "org.meveo.api.dto.notification.ScriptNotificationDto",
    "dtoData" : {
      "active" : true,
      "code" : "GenerateCustomEntityGUI",
      "classNameFilter" : "org.meveo.model.customEntities.CustomEntityInstance",
      "eventTypeFilter" : "CREATED",
      "elFilter" : "#{event.getCetCode() == 'ENTITY_GUI_CONFIG'}",
      "scriptInstanceCode" : "org.meveo.script.GenerateCustomEntityGUIScript",
      "scriptParams" : {
        "config" : "${event}"
      },
      "priority" : 1
    }
  }, {
    "dtoClassName" : "org.meveo.api.dto.CustomEntityTemplateDto",
    "dtoData" : {
      "code" : "ENTITY_GUI_CONFIG",
      "name" : "Entity UI Application Configuration",
      "description" : "Create GUI for a Custom Entity",
      "customEntityCategoryCode" : "ENTITY_UI",
      "availableStorages" : [ "SQL" ],
      "sqlStorageConfiguration" : {
        "storeAsTable" : false
      },
      "samples" : [ ],
      "fields" : [ {
        "code" : "label",
        "description" : "The label that shows up for menu's and notifications regarding this entity",
        "fieldType" : "STRING",
        "accountLevel" : "CE_ENTITY_GUI_CONFIG",
        "appliesTo" : "CE_ENTITY_GUI_CONFIG",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : true,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "maxValue" : 255,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Entity UI Application Configuration:0;field:1",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "name",
        "description" : "The Entity's name",
        "fieldType" : "STRING",
        "accountLevel" : "CE_ENTITY_GUI_CONFIG",
        "appliesTo" : "CE_ENTITY_GUI_CONFIG",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : true,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "maxValue" : 255,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Entity UI Application Configuration:0;field:0",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      } ],
      "actions" : [ ]
    }
  }, {
    "dtoClassName" : "org.meveo.api.dto.ScriptInstanceDto",
    "dtoData" : {
      "active" : true,
      "code" : "org.meveo.script.GenerateCustomEntityGUIScript",
      "description" : "GenerateCustomEntityGUIScript",
      "inputs" : [ ],
      "outputs" : [ ],
      "generateOutputs" : false,
      "type" : "JAVA",
      "script" : "package org.meveo.script;\n\nimport java.io.File;\nimport java.util.Arrays;\nimport java.util.Map;\nimport org.meveo.service.script.Script;\nimport org.meveo.admin.exception.BusinessException;\nimport org.meveo.commons.utils.FileUtils;\nimport org.meveo.model.customEntities.CustomEntityInstance;\nimport org.meveo.model.customEntities.CustomEntityTemplate;\nimport org.meveo.service.custom.CustomEntityInstanceService;\nimport org.meveo.service.custom.CustomEntityTemplateService;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\npublic class GenerateCustomEntityGUIScript extends Script {\n\n    private static final Logger LOG = LoggerFactory.getLogger(GenerateCustomEntityGUIScript.class);\n    private CustomEntityInstanceService customEntityInstanceService = getCDIBean(CustomEntityInstanceService.class);\n    private CustomEntityTemplateService customEntityTemplateService = getCDIBean(CustomEntityTemplateService.class);\n\n    @Override\n    public void execute(Map<String, Object> parameters) throws BusinessException {\n        super.execute(parameters);\n\n        LOG.debug(\"GenerateCustomEntityGUIScript ==> START\");\n\n        CustomEntityInstance configCEI = (CustomEntityInstance) parameters.get(\"config\");\n        String entityName = configCEI.getCfValuesNullSafe().getCfValue(\"name\").getStringValue();\n        String entityLabel = configCEI.getCfValuesNullSafe().getCfValue(\"label\").getStringValue();\n\n        LOG.debug(\"config code: {}\", configCEI.getCode());\n        LOG.debug(\"entityName: {}\", entityName);\n        LOG.debug(\"entityLabel: {}\", entityLabel);\n\n        CustomEntityTemplate templatePathCET = customEntityTemplateService.findByCodeOrDbTablename(\"TEMPLATE_PATH\");\n        CustomEntityInstance templatePathCEI = customEntityInstanceService.findByCodeByCet(templatePathCET.getCode(),\n                \"ENTITY_GUI_TEMPLATE_PATH\");\n        String templatePath = templatePathCEI.getCfValuesNullSafe().getCfValue(\"path\").getStringValue();\n\n        LOG.debug(\"templatePath: {}\", templatePath);\n\n        File templateDirectory = new File(templatePath);\n        if (templateDirectory.exists() && templateDirectory.isDirectory()) {\n            File[] templateFiles = templateDirectory.listFiles();\n            LOG.debug(\"Files found: {}\", templateFiles.length);\n            for (File templateFile : templateFiles) {\n                LOG.debug(\"TEMPLATE FILE: {}\", templateFile.getPath());\n            }\n        }\n\n        LOG.debug(\"GenerateCustomEntityGUIScript ==> END\");\n    }\n}\n",
      "executionRoles" : [ ],
      "sourcingRoles" : [ ],
      "mavenDependencies" : [ ],
      "importScriptInstances" : [ ]
    }
  }, {
    "dtoClassName" : "org.meveo.api.dto.CustomEntityCategoryDto",
    "dtoData" : {
      "code" : "ENTITY_UI",
      "name" : "Entity GUI"
    }
  } ],
  "moduleDependencies" : [ ],
  "moduleFiles" : [ ]
} ]