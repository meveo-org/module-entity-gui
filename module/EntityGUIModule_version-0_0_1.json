[ {
  "active" : true,
  "code" : "EntityGUIModule",
  "description" : "Entity GUI Module",
  "license" : "GPL",
  "currentVersion" : "0.0.1",
  "transient" : true,
  "inDraft" : true,
  "codeOnly" : false,
  "moduleItems" : [ {
    "dtoClassName" : "org.meveo.api.dto.notification.ScriptNotificationDto",
    "dtoData" : {
      "active" : true,
      "code" : "GenerateCustomEntityGUI",
      "classNameFilter" : "org.meveo.model.customEntities.CustomEntityInstance",
      "eventTypeFilter" : "CREATED",
      "elFilter" : "#{event.getCetCode() == 'ENTITY_GUI_CONFIG'}",
      "scriptInstanceCode" : "org.meveo.script.GenerateCustomEntityGUIScript",
      "scriptParams" : {
        "config" : "${event}"
      },
      "priority" : 1
    }
  }, {
    "dtoClassName" : "org.meveo.api.dto.CustomEntityTemplateDto",
    "dtoData" : {
      "code" : "ENTITY_GUI_CONFIG",
      "name" : "Entity UI Application Configuration",
      "description" : "Create GUI for a Custom Entity",
      "customEntityCategoryCode" : "ENTITY_UI",
      "availableStorages" : [ "SQL" ],
      "sqlStorageConfiguration" : {
        "storeAsTable" : false
      },
      "samples" : [ ],
      "fields" : [ {
        "code" : "label",
        "description" : "The label that shows up for menu's and notifications regarding this entity",
        "fieldType" : "STRING",
        "accountLevel" : "CE_ENTITY_GUI_CONFIG",
        "appliesTo" : "CE_ENTITY_GUI_CONFIG",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : true,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "maxValue" : 255,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Entity UI Application Configuration:0;field:1",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "name",
        "description" : "The Entity's name",
        "fieldType" : "STRING",
        "accountLevel" : "CE_ENTITY_GUI_CONFIG",
        "appliesTo" : "CE_ENTITY_GUI_CONFIG",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : true,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "maxValue" : 255,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Entity UI Application Configuration:0;field:0",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      } ],
      "actions" : [ ]
    }
  }, {
    "dtoClassName" : "org.meveo.api.dto.ScriptInstanceDto",
    "dtoData" : {
      "active" : true,
      "code" : "org.meveo.script.GenerateCustomEntityGUIScript",
      "description" : "GenerateCustomEntityGUIScript",
      "inputs" : [ ],
      "outputs" : [ ],
      "generateOutputs" : false,
      "type" : "JAVA",
      "script" : "package org.meveo.script;\r\n\r\nimport java.io.File;\r\nimport java.util.Arrays;\r\nimport java.util.Map;\r\nimport org.meveo.service.script.Script;\r\nimport org.meveo.admin.exception.BusinessException;\r\nimport org.meveo.commons.utils.FileUtils;\r\nimport org.meveo.model.customEntities.CustomEntityInstance;\r\nimport org.meveo.model.customEntities.CustomEntityTemplate;\r\nimport org.meveo.service.custom.CustomEntityInstanceService;\r\nimport org.meveo.service.custom.CustomEntityTemplateService;\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\n\r\npublic class GenerateCustomEntityGUIScript extends Script {\r\n\r\n    private static final Logger LOG = LoggerFactory.getLogger(GenerateCustomEntityGUIScript.class);\r\n    private CustomEntityInstanceService customEntityInstanceService = getCDIBean(CustomEntityInstanceService.class);\r\n    private CustomEntityTemplateService customEntityTemplateService = getCDIBean(CustomEntityTemplateService.class);\r\n\r\n    @Override\r\n    public void execute(Map<String, Object> parameters) throws BusinessException {\r\n        super.execute(parameters);\r\n        \r\n        LOG.debug(\"GenerateCustomEntityGUIScript ==> START\");\r\n        \r\n        CustomEntityInstance configCEI = (CustomEntityInstance) parameters.get(\"config\");\r\n        String entityName = configCEI.getCfValuesNullSafe().getCfValue(\"name\").getStringValue();\r\n        String entityLabel = configCEI.getCfValuesNullSafe().getCfValue(\"label\").getStringValue();\r\n\r\n        LOG.debug(\"config code: {}\", configCEI.getCode());\r\n        LOG.debug(\"entityName: {}\", entityName);\r\n        LOG.debug(\"entityLabel: {}\", entityLabel);\r\n\r\n        CustomEntityTemplate templatePathCET = customEntityTemplateService.findByCodeOrDbTablename(\"TEMPLATE_PATH\");\r\n        CustomEntityInstance templatePathCEI = customEntityInstanceService\r\n                .findByCodeByCet(templatePathCET.getCode(), \"ENTITY_GUI_TEMPLATE_PATH\");\r\n        String templatePath = templatePathCEI.getCfValuesNullSafe().getCfValue(\"path\").getStringValue();\r\n        \r\n        LOG.debug(\"templatePath: {}\", templatePath);\r\n\r\n        File[] templateFiles = FileUtils.listFiles(templatePath, Arrays.asList(\"js\"));\r\n\r\n        LOG.debug(\"Files found: {}\", templateFiles.length);\r\n        for(File templateFile: templateFiles) {\r\n            LOG.debug(\"TEMPLATE FILE: {}\", templateFile.getPath());\r\n        }\r\n\r\n        LOG.debug(\"GenerateCustomEntityGUIScript ==> END\");\r\n    }\r\n}\r\n",
      "executionRoles" : [ ],
      "sourcingRoles" : [ ],
      "mavenDependencies" : [ ],
      "importScriptInstances" : [ ]
    }
  }, {
    "dtoClassName" : "org.meveo.api.dto.CustomEntityCategoryDto",
    "dtoData" : {
      "code" : "ENTITY_UI",
      "name" : "Entity GUI"
    }
  } ],
  "moduleDependencies" : [ ],
  "moduleFiles" : [ ]
} ]